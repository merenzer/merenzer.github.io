<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anadolu Sigorta | Kupa & Lig Yönetimi</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-base: #f5f7fa; --bg-detail: #c3cfe2; --accent: #003366;
            --text-color: #2c3e50; --card-bg: rgba(255, 255, 255, 0.95); --sidebar-bg: #ffffff;
        }
        body { margin: 0; display: flex; font-family: 'Segoe UI', sans-serif; background-color: var(--bg-base); background-image: radial-gradient(circle at 15% 25%, var(--bg-detail) 0%, transparent 45%), radial-gradient(circle at 85% 75%, var(--bg-detail) 0%, transparent 45%); background-attachment: fixed; min-height: 100vh; color: var(--text-color); transition: all 0.6s; overflow-x: auto; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--sidebar-bg); backdrop-filter: blur(25px); border-right: 1px solid rgba(0,0,0,0.1); display: flex; flex-direction: column; padding: 30px 15px; height: 100vh; position: sticky; left: 0; z-index: 1000; }
        .logo-box { padding: 10px; margin-bottom: 40px; text-align: center; display: flex; align-items: center; justify-content: center; }
        .logo-box img { max-width: 160px; }
        .cup-btn { border: 1px solid rgba(0,0,0,0.08); padding: 12px 15px; border-radius: 12px; cursor: pointer; font-weight: 700; background: white; margin-bottom: 10px; width: 100%; text-align: left; }
        .cup-btn.active { background: var(--accent); color: white; }

        .main-content { padding: 40px; min-width: 1100px; flex: 1; }
        .view-tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .tab-btn { padding: 10px 25px; border-radius: 30px; border: 2px solid var(--accent); background: transparent; color: var(--text-color); font-weight: bold; cursor: pointer; }
        .tab-btn.active { background: var(--accent); color: white; }

        /* SKOR GİRİŞİ (Admin Modu) */
        .score-input { width: 40px; text-align: center; border: 1px solid var(--accent); border-radius: 4px; font-weight: bold; display: none; }
        .admin-active .score-input { display: inline-block; }
        .admin-active .score-display { display: none; }
        
        .league-table { width: 100%; max-width: 900px; margin: 0 auto; background: var(--card-bg); border-radius: 15px; border-collapse: collapse; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .league-table th { background: var(--accent); color: white; padding: 12px; }
        .league-table td { padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.05); text-align: center; }

        .bracket-wrapper { display: flex; gap: 30px; justify-content: center; }
        .round { display: flex; flex-direction: column; width: 230px; }
        .match-card { background: var(--card-bg); border-radius: 12px; margin: 10px 0; border: 1px solid rgba(0,0,0,0.1); }
        .team { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; font-size: 12px; font-weight: bold; }
        .team-logo { width: 20px; height: 20px; margin-right: 8px; vertical-align: middle; }

        /* Login Modal */
        #login-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; text-align: center; color: #333; }

        .admin-trigger { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 10px 20px; border-radius: 30px; cursor: pointer; }
        .save-btn { display: none; position: fixed; bottom: 20px; right: 150px; background: #28a745; color: white; padding: 10px 30px; border-radius: 30px; cursor: pointer; border: none; font-weight: bold; }
    </style>
</head>
<body id="body-tag">

    <aside class="sidebar">
        <div class="logo-box">
            <img id="cup-logo" src="../logolar/federasyon.png" alt="Logo" onerror="this.src='../logolar/image_dd686a.jpg'">
        </div>
        <nav class="nav-menu">
            <button class="cup-btn active" id="btn-fed" onclick="changeCup('federasyon', this)">Federasyon Kupası</button>
            <button class="cup-btn" onclick="changeCup('sampiyonlar', this)">Şampiyonlar Ligi</button>
            <button class="cup-btn" onclick="changeCup('uefa', this)">UEFA Avrupa Ligi</button>
            <button class="cup-btn" onclick="changeCup('konferans', this)">Konferans Ligi</button>
        </nav>
    </aside>

    <main class="main-content">
        <h1 id="main-title" style="text-align:center;">Federasyon Kupası</h1>
        <div id="tab-area" class="view-tabs" style="display:none;">
            <button class="tab-btn active" onclick="switchView('league')">Lig Aşaması</button>
            <button class="tab-btn" onclick="switchView('playoff')">Elemeler & Play-off</button>
        </div>
        <div id="display-area"></div>
    </main>

    <div class="admin-trigger" id="login-btn" onclick="showLogin()">Yönetici Girişi</div>
    <button class="save-btn" id="save-btn" onclick="saveData()">Değişiklikleri Kaydet</button>

    <div id="login-modal">
        <div class="modal-content">
            <h3>Yönetici Girişi</h3>
            <input type="password" id="admin-pass" placeholder="Şifre" style="padding:10px; margin-bottom:10px;"><br>
            <button onclick="login()">Giriş Yap</button>
            <button onclick="closeLogin()">İptal</button>
        </div>
    </div>

    <script>
        // FIREBASE CONFIG - BURAYI KENDİ BİLGİLERİNLE DOLDUR
        const firebaseConfig = {
            apiKey: "SENIN_API_KEY",
            databaseURL: "SENIN_DB_URL",
            projectId: "SENIN_PROJECT_ID",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let isAdmin = false;
        let activeCup = 'federasyon';
        let currentView = 'league';
        let localData = {};

        // Verileri Firebase'den Çek
        function loadData() {
            db.ref('tournamentData').on('value', (snapshot) => {
                localData = snapshot.val() || {};
                renderContent();
            });
        }

        // Akıllı Logo
        function getLogo(team) {
            if(!team || team.includes('Winner')) return '';
            let clean = team.replace('*', '').trim();
            return `<img src="../logolar/${clean}.png" class="team-logo" onerror="this.onerror=null; this.src='../logolar2/${clean}.png';">`;
        }

        function renderContent() {
            const area = document.getElementById('display-area');
            if(activeCup === 'federasyon') {
                area.innerHTML = renderFederasyon();
            } else {
                area.innerHTML = currentView === 'league' ? renderLeague() : renderPlayoffs();
            }
        }

        // Federasyon Kupası (Bracket) Çizimi
        function renderFederasyon() {
            const rounds = [{id: 'Son 32', count: 16}, {id: 'Son 16', count: 8}, {id: 'Çeyrek', count: 4}, {id: 'Yarı', count: 2}, {id: 'Final', count: 1}];
            let html = `<div class="bracket-wrapper">`;
            rounds.forEach((r, rIdx) => {
                html += `<div class="round"><h4>${r.id}</h4>`;
                for(let i=0; i<r.count; i++) {
                    const match = (localData.federasyon?.[rIdx]?.[i]) || {t1: 'Bekleniyor', t2: 'Bekleniyor', s1: '-', s2: '-'};
                    html += `
                        <div class="match-card">
                            <div class="team">${getLogo(match.t1)} ${match.t1} 
                                <span class="score-display">${match.s1}</span>
                                <input type="text" class="score-input" value="${match.s1}" onchange="updateFedScore(${rIdx}, ${i}, 's1', this.value)">
                            </div>
                            <div class="team">${getLogo(match.t2)} ${match.t2} 
                                <span class="score-display">${match.s2}</span>
                                <input type="text" class="score-input" value="${match.s2}" onchange="updateFedScore(${rIdx}, ${i}, 's2', this.value)">
                            </div>
                        </div>`;
                }
                html += `</div>`;
            });
            return html + `</div>`;
        }

        // Admin Fonksiyonları
        function showLogin() { document.getElementById('login-modal').style.display = 'flex'; }
        function closeLogin() { document.getElementById('login-modal').style.display = 'none'; }
        function login() {
            const pass = document.getElementById('admin-pass').value;
            if(pass === "1234") { // Basit şifre örneği
                isAdmin = true;
                document.getElementById('body-tag').classList.add('admin-active');
                document.getElementById('save-btn').style.display = 'block';
                closeLogin();
            } else { alert("Hatalı Şifre!"); }
        }

        // Skor Güncelleme ve Otomatik İlerleme
        function updateFedScore(r, m, team, val) {
            if(!localData.federasyon) localData.federasyon = {};
            if(!localData.federasyon[r]) localData.federasyon[r] = {};
            if(!localData.federasyon[r][m]) localData.federasyon[r][m] = {t1:'?', t2:'?', s1:'-', s2:'-'};
            
            localData.federasyon[r][m][team] = val;

            // OTOMATİK İLERLEME MANTIĞI
            const s1 = parseInt(localData.federasyon[r][m].s1);
            const s2 = parseInt(localData.federasyon[r][m].s2);
            
            if(!isNaN(s1) && !isNaN(s2)) {
                const winner = s1 > s2 ? localData.federasyon[r][m].t1 : localData.federasyon[r][m].t2;
                const nextRound = r + 1;
                const nextMatch = Math.floor(m / 2);
                const nextTeamPos = m % 2 === 0 ? 't1' : 't2';

                if(!localData.federasyon[nextRound]) localData.federasyon[nextRound] = {};
                if(!localData.federasyon[nextRound][nextMatch]) localData.federasyon[nextRound][nextMatch] = {t1:'Bekleniyor', t2:'Bekleniyor', s1:'-', s2:'-'};
                
                localData.federasyon[nextRound][nextMatch][nextTeamPos] = winner;
            }
        }

        function saveData() {
            db.ref('tournamentData').set(localData).then(() => {
                alert("Veriler Başarıyla Kaydedildi!");
            });
        }

        // Turnuva Değiştirme
        function changeCup(cup, btn) {
            activeCup = cup;
            document.querySelectorAll('.cup-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Tema ve Logo Ayarları
            const themes = {
                'federasyon': { base: '#f5f7fa', det: '#c3cfe2', acc: '#003366', title: 'Federasyon Kupası' },
                'sampiyonlar': { base: '#091442', det: '#3562A6', acc: '#3562A6', title: 'Champions League' },
                'uefa': { base: '#0D0D0D', det: '#D85C00', acc: '#F47E01', title: 'Europa League' },
                'konferans': { base: '#000000', det: '#022e05', acc: '#03c221', title: 'Conference League' }
            };
            const t = themes[cup];
            document.documentElement.style.setProperty('--bg-base', t.base);
            document.documentElement.style.setProperty('--bg-detail', t.det);
            document.documentElement.style.setProperty('--accent', t.acc);
            document.getElementById('main-title').innerText = t.title;
            document.getElementById('cup-logo').src = `../logolar/${cup}.png`;
            
            document.getElementById('tab-area').style.display = cup === 'federasyon' ? 'none' : 'flex';
            renderContent();
        }

        window.onload = loadData;
    </script>
</body>
</html>
